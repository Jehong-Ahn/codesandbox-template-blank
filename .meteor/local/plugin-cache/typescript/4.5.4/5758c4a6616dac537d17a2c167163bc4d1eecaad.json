{"metadata":{},"options":{"assumptions":{},"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"/workspace/codesandbox-template-blank/packages/react-meteor-data/useTracker.ts","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining",["pipelineOperator",{"proposal":"minimal"}],"throwExpressions","classProperties","classPrivateProperties","jsx","nullishCoalescingOperator","nullishCoalescingOperator","optionalChaining","optionalCatchBinding","optionalCatchBinding","classProperties","classPrivateProperties","classPrivateMethods","classProperties","classPrivateProperties","asyncGenerators","asyncGenerators","objectRestSpread","logicalAssignment"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"allowUndeclaredExports":true,"strictMode":false},"caller":{"name":"meteor","arch":"web.browser"},"sourceFileName":"packages/react-meteor-data/useTracker.ts","filename":"/workspace/codesandbox-template-blank/packages/react-meteor-data/useTracker.ts","inputSourceMap":{"version":3,"file":"packages/react-meteor-data/useTracker.ts","sourceRoot":"","sources":["packages/react-meteor-data/useTracker.ts"],"names":[],"mappings":"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","sourcesContent":["declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo, DependencyList } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor (data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nexport interface IReactiveFn<T> {\n  (c?: Tracker.Computation): T\n}\n\nexport interface ISkipUpdate<T> {\n  <T>(prev: T, next: T): boolean\n}\n\ntype TrackerRefs = {\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  trackerData: any;\n}\n\nconst useTrackerNoDeps = <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate: ISkipUpdate<T> = null) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    const data = reactiveFn(c);\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = data;\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, data)) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  }));\n\n  // To clean up side effects in render, stop the computation immediately\n  if (!refs.isMounted) {\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.computation) {\n        refs.computation.stop();\n        delete refs.computation;\n      }\n    });\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. In those cases, we might as well leave the\n    // computation alone!\n    if (!refs.computation) {\n      // Render is committed, but we no longer have a computation. Invoke\n      // forceUpdate and let the next render recreate the computation.\n      if (!skipUpdate) {\n        forceUpdate();\n      } else {\n        Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n          const data = reactiveFn(c);\n          refs.computation = c;\n          if (!skipUpdate(refs.trackerData, data)) {\n            // For any reactive change, forceUpdate and let the next render rebuild the computation.\n            forceUpdate();\n          }\n        }));\n      }\n    }\n\n    // stop the computation on unmount\n    return () =>{\n      refs.computation?.stop();\n      delete refs.computation;\n      refs.isMounted = false;\n    }\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps = <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList, skipUpdate: ISkipUpdate<T> = null): T => {\n  const forceUpdate = useForceUpdate();\n\n  const { current: refs } = useRef<{\n    reactiveFn: IReactiveFn<T>;\n    data?: T;\n    comp?: Tracker.Computation;\n    isMounted?: boolean;\n  }>({ reactiveFn });\n\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(\n      () => Tracker.autorun((c: Tracker.Computation) => {\n        const data = refs.reactiveFn();\n        if (c.firstRun) {\n          refs.data = data;\n        } else if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      })\n    );\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. This will allow it to be stopped earlier in\n    // useEffect if needed.\n    refs.comp = comp;\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.comp) {\n        refs.comp.stop();\n        delete refs.comp;\n      }\n    });\n  }, deps);\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    if (!refs.comp) {\n      refs.comp = Tracker.nonreactive(\n        () => Tracker.autorun((c) => {\n          const data: T = refs.reactiveFn(c);\n          if (!skipUpdate || !skipUpdate(refs.data, data)) {\n            refs.data = data;\n            forceUpdate();\n          }\n        })\n      );\n    }\n\n    return () => {\n      refs.comp.stop();\n      delete refs.comp;\n      refs.isMounted = false;\n    };\n  }, deps);\n\n  return refs.data as T;\n};\n\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps?: DependencyList, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList | ISkipUpdate<T> = null, skipUpdate: ISkipUpdate<T> = null): T {\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer: typeof useTrackerClient = (reactiveFn) => {\n  return Tracker.nonreactive(reactiveFn);\n}\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nfunction useTrackerDev (reactiveFn, deps = null, skipUpdate = null) {\n  function warn (expects: string, pos: string, arg: string, type: string) {\n    console.warn(\n      `Warning: useTracker expected a ${expects} in it\\'s ${pos} argument `\n        + `(${arg}), but got type of \\`${type}\\`.`\n    );\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\",\n      `${typeof deps} & ${typeof skipUpdate}`);\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nexport default Meteor.isDevelopment\n  ? useTrackerDev as typeof useTrackerClient\n  : useTracker;\n"]},"targets":{},"cloneInputAst":true,"browserslistConfigFile":false,"passPerPreset":false,"envName":"development","cwd":"/workspace/codesandbox-template-blank","root":"/workspace/codesandbox-template-blank","rootMode":"root","plugins":[{"key":"base$0","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"base$0$0","visitor":{"Program":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true},"options":{"avoidModernSyntax":false,"enforceStrictMode":false,"dynamicImport":true,"generateLetDeclarations":true},"externalDependencies":[]},{"key":"transform-runtime","visitor":{"MemberExpression":{"enter":[null]},"ObjectPattern":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":{},"_verified":{},"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"version":"7.17.2","helpers":true,"useESModules":false,"corejs":false},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{"loose":true},"externalDependencies":[]},{"key":"transform-react-jsx","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXSpreadChild":{"enter":[null]},"Program":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","runtime":"classic","throwIfNamespace":true,"useBuiltIns":false},"externalDependencies":[]},{"key":"transform-react-display-name","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-react-pure-annotations","visitor":{"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-nullish-coalescing-operator","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-nullish-coalescing-operator","visitor":{"_exploded":{},"_verified":{},"LogicalExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-optional-chaining","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-chaining","visitor":{"_exploded":true,"OptionalCallExpression":{"enter":[null]},"OptionalMemberExpression":{"enter":[null]},"_verified":true},"options":{},"externalDependencies":[]},{"key":"syntax-optional-catch-binding","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-optional-catch-binding","visitor":{"_exploded":{},"_verified":{},"CatchClause":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-class-properties","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-class-properties","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ClassExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-async-generators","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-async-generator-functions","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"syntax-object-rest-spread","visitor":{"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"proposal-object-rest-spread","visitor":{"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ArrayPattern":{"enter":[null]},"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"proposal-logical-assignment-operators","visitor":{"_exploded":{},"_verified":{},"AssignmentExpression":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-literals","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-template-literals","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]},{"key":"transform-parameters","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ClassPrivateMethod":{"enter":[null]}},"options":{},"externalDependencies":[]},{"key":"transform-exponentiation-operator","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{},"externalDependencies":[]}],"presets":[],"generatorOpts":{"filename":"/workspace/codesandbox-template-blank/packages/react-meteor-data/useTracker.ts","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/react-meteor-data/useTracker.ts"}},"code":"let Meteor;\nmodule.link(\"meteor/meteor\", {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Tracker;\nmodule.link(\"meteor/tracker\", {\n  Tracker(v) {\n    Tracker = v;\n  }\n\n}, 1);\nlet useReducer, useEffect, useRef, useMemo;\nmodule.link(\"react\", {\n  useReducer(v) {\n    useReducer = v;\n  },\n\n  useEffect(v) {\n    useEffect = v;\n  },\n\n  useRef(v) {\n    useRef = v;\n  },\n\n  useMemo(v) {\n    useMemo = v;\n  }\n\n}, 2);\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor(data) {\n  let shouldWarn = false;\n\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach(key => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n\n  if (shouldWarn) {\n    console.warn('Warning: your reactive function is returning a Mongo cursor. ' + 'This value will not be reactive. You probably want to call ' + '`.fetch()` on the cursor before returning it.');\n  }\n} // Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\n\n\nconst fur = x => x + 1;\n\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nconst useTrackerNoDeps = function (reactiveFn) {\n  let skipUpdate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  const {\n    current: refs\n  } = useRef({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate(); // Without deps, always dispose and recreate the computation with every render.\n\n  if (refs.computation) {\n    refs.computation.stop(); // @ts-ignore This makes TS think ref.computation is \"never\" set\n\n    delete refs.computation;\n  } // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n\n\n  Tracker.nonreactive(() => Tracker.autorun(c => {\n    refs.computation = c;\n    const data = reactiveFn(c);\n\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = data;\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, data)) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  })); // To clean up side effects in render, stop the computation immediately\n\n  if (!refs.isMounted) {\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.computation) {\n        refs.computation.stop();\n        delete refs.computation;\n      }\n    });\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true; // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. In those cases, we might as well leave the\n    // computation alone!\n\n    if (!refs.computation) {\n      // Render is committed, but we no longer have a computation. Invoke\n      // forceUpdate and let the next render recreate the computation.\n      if (!skipUpdate) {\n        forceUpdate();\n      } else {\n        Tracker.nonreactive(() => Tracker.autorun(c => {\n          const data = reactiveFn(c);\n          refs.computation = c;\n\n          if (!skipUpdate(refs.trackerData, data)) {\n            // For any reactive change, forceUpdate and let the next render rebuild the computation.\n            forceUpdate();\n          }\n        }));\n      }\n    } // stop the computation on unmount\n\n\n    return () => {\n      var _refs$computation;\n\n      (_refs$computation = refs.computation) === null || _refs$computation === void 0 ? void 0 : _refs$computation.stop();\n      delete refs.computation;\n      refs.isMounted = false;\n    };\n  }, []);\n  return refs.trackerData;\n};\n\nconst useTrackerWithDeps = function (reactiveFn, deps) {\n  let skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  const forceUpdate = useForceUpdate();\n  const {\n    current: refs\n  } = useRef({\n    reactiveFn\n  }); // keep reactiveFn ref fresh\n\n  refs.reactiveFn = reactiveFn;\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(() => Tracker.autorun(c => {\n      const data = refs.reactiveFn();\n\n      if (c.firstRun) {\n        refs.data = data;\n      } else if (!skipUpdate || !skipUpdate(refs.data, data)) {\n        refs.data = data;\n        forceUpdate();\n      }\n    })); // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. This will allow it to be stopped earlier in\n    // useEffect if needed.\n\n    refs.comp = comp; // To avoid creating side effects in render, stop the computation immediately\n\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.comp) {\n        refs.comp.stop();\n        delete refs.comp;\n      }\n    });\n  }, deps);\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    if (!refs.comp) {\n      refs.comp = Tracker.nonreactive(() => Tracker.autorun(c => {\n        const data = refs.reactiveFn(c);\n\n        if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      }));\n    }\n\n    return () => {\n      refs.comp.stop();\n      delete refs.comp;\n      refs.isMounted = false;\n    };\n  }, deps);\n  return refs.data;\n};\n\nfunction useTrackerClient(reactiveFn) {\n  let deps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  let skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer = reactiveFn => {\n  return Tracker.nonreactive(reactiveFn);\n}; // When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\n\n\nconst useTracker = Meteor.isServer ? useTrackerServer : useTrackerClient;\n\nfunction useTrackerDev(reactiveFn) {\n  let deps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n  let skipUpdate = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  function warn(expects, pos, arg, type) {\n    console.warn(\"Warning: useTracker expected a \".concat(expects, \" in it's \").concat(pos, \" argument \") + \"(\".concat(arg, \"), but got type of `\").concat(type, \"`.\"));\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\", \"\".concat(typeof deps, \" & \").concat(typeof skipUpdate));\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nmodule.exportDefault(Meteor.isDevelopment ? useTrackerDev : useTracker);","map":{"version":3,"mappings":"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","names":["module","Meteor","Tracker","useReducer","useEffect","useRef","useMemo","checkCursor","data","shouldWarn","Package","mongo","Mongo","Cursor","Object","getPrototypeOf","prototype","keys","forEach","key","console","warn","fur","x","useForceUpdate","useTrackerNoDeps","reactiveFn","skipUpdate","current","refs","isMounted","trackerData","forceUpdate","computation","stop","nonreactive","autorun","c","firstRun","defer","useTrackerWithDeps","deps","comp","useTrackerClient","undefined","Array","isArray","useTrackerServer","useTracker","isServer","useTrackerDev","expects","pos","arg","type","exportDefault","isDevelopment"],"sourceRoot":"","sources":["packages/react-meteor-data/useTracker.ts"],"sourcesContent":["declare var Package: any\nimport { Meteor } from 'meteor/meteor';\nimport { Tracker } from 'meteor/tracker';\nimport { useReducer, useEffect, useRef, useMemo, DependencyList } from 'react';\n\n// Warns if data is a Mongo.Cursor or a POJO containing a Mongo.Cursor.\nfunction checkCursor (data: any): void {\n  let shouldWarn = false;\n  if (Package.mongo && Package.mongo.Mongo && data && typeof data === 'object') {\n    if (data instanceof Package.mongo.Mongo.Cursor) {\n      shouldWarn = true;\n    } else if (Object.getPrototypeOf(data) === Object.prototype) {\n      Object.keys(data).forEach((key) => {\n        if (data[key] instanceof Package.mongo.Mongo.Cursor) {\n          shouldWarn = true;\n        }\n      });\n    }\n  }\n  if (shouldWarn) {\n    console.warn(\n      'Warning: your reactive function is returning a Mongo cursor. '\n      + 'This value will not be reactive. You probably want to call '\n      + '`.fetch()` on the cursor before returning it.'\n    );\n  }\n}\n\n// Used to create a forceUpdate from useReducer. Forces update by\n// incrementing a number whenever the dispatch method is invoked.\nconst fur = (x: number): number => x + 1;\nconst useForceUpdate = () => useReducer(fur, 0)[1];\n\nexport interface IReactiveFn<T> {\n  (c?: Tracker.Computation): T\n}\n\nexport interface ISkipUpdate<T> {\n  <T>(prev: T, next: T): boolean\n}\n\ntype TrackerRefs = {\n  computation?: Tracker.Computation;\n  isMounted: boolean;\n  trackerData: any;\n}\n\nconst useTrackerNoDeps = <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate: ISkipUpdate<T> = null) => {\n  const { current: refs } = useRef<TrackerRefs>({\n    isMounted: false,\n    trackerData: null\n  });\n  const forceUpdate = useForceUpdate();\n\n  // Without deps, always dispose and recreate the computation with every render.\n  if (refs.computation) {\n    refs.computation.stop();\n    // @ts-ignore This makes TS think ref.computation is \"never\" set\n    delete refs.computation;\n  }\n\n  // Use Tracker.nonreactive in case we are inside a Tracker Computation.\n  // This can happen if someone calls `ReactDOM.render` inside a Computation.\n  // In that case, we want to opt out of the normal behavior of nested\n  // Computations, where if the outer one is invalidated or stopped,\n  // it stops the inner one.\n  Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n    refs.computation = c;\n    const data = reactiveFn(c);\n    if (c.firstRun) {\n      // Always run the reactiveFn on firstRun\n      refs.trackerData = data;\n    } else if (!skipUpdate || !skipUpdate(refs.trackerData, data)) {\n      // For any reactive change, forceUpdate and let the next render rebuild the computation.\n      forceUpdate();\n    }\n  }));\n\n  // To clean up side effects in render, stop the computation immediately\n  if (!refs.isMounted) {\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.computation) {\n        refs.computation.stop();\n        delete refs.computation;\n      }\n    });\n  }\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. In those cases, we might as well leave the\n    // computation alone!\n    if (!refs.computation) {\n      // Render is committed, but we no longer have a computation. Invoke\n      // forceUpdate and let the next render recreate the computation.\n      if (!skipUpdate) {\n        forceUpdate();\n      } else {\n        Tracker.nonreactive(() => Tracker.autorun((c: Tracker.Computation) => {\n          const data = reactiveFn(c);\n          refs.computation = c;\n          if (!skipUpdate(refs.trackerData, data)) {\n            // For any reactive change, forceUpdate and let the next render rebuild the computation.\n            forceUpdate();\n          }\n        }));\n      }\n    }\n\n    // stop the computation on unmount\n    return () =>{\n      refs.computation?.stop();\n      delete refs.computation;\n      refs.isMounted = false;\n    }\n  }, []);\n\n  return refs.trackerData;\n}\n\nconst useTrackerWithDeps = <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList, skipUpdate: ISkipUpdate<T> = null): T => {\n  const forceUpdate = useForceUpdate();\n\n  const { current: refs } = useRef<{\n    reactiveFn: IReactiveFn<T>;\n    data?: T;\n    comp?: Tracker.Computation;\n    isMounted?: boolean;\n  }>({ reactiveFn });\n\n  // keep reactiveFn ref fresh\n  refs.reactiveFn = reactiveFn;\n\n  useMemo(() => {\n    // To jive with the lifecycle interplay between Tracker/Subscribe, run the\n    // reactive function in a computation, then stop it, to force flush cycle.\n    const comp = Tracker.nonreactive(\n      () => Tracker.autorun((c: Tracker.Computation) => {\n        const data = refs.reactiveFn();\n        if (c.firstRun) {\n          refs.data = data;\n        } else if (!skipUpdate || !skipUpdate(refs.data, data)) {\n          refs.data = data;\n          forceUpdate();\n        }\n      })\n    );\n    // In some cases, the useEffect hook will run before Meteor.defer, such as\n    // when React.lazy is used. This will allow it to be stopped earlier in\n    // useEffect if needed.\n    refs.comp = comp;\n    // To avoid creating side effects in render, stop the computation immediately\n    Meteor.defer(() => {\n      if (!refs.isMounted && refs.comp) {\n        refs.comp.stop();\n        delete refs.comp;\n      }\n    });\n  }, deps);\n\n  useEffect(() => {\n    // Let subsequent renders know we are mounted (render is committed).\n    refs.isMounted = true;\n\n    if (!refs.comp) {\n      refs.comp = Tracker.nonreactive(\n        () => Tracker.autorun((c) => {\n          const data: T = refs.reactiveFn(c);\n          if (!skipUpdate || !skipUpdate(refs.data, data)) {\n            refs.data = data;\n            forceUpdate();\n          }\n        })\n      );\n    }\n\n    return () => {\n      refs.comp.stop();\n      delete refs.comp;\n      refs.isMounted = false;\n    };\n  }, deps);\n\n  return refs.data as T;\n};\n\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps?: DependencyList, skipUpdate?: ISkipUpdate<T>): T;\nfunction useTrackerClient <T = any>(reactiveFn: IReactiveFn<T>, deps: DependencyList | ISkipUpdate<T> = null, skipUpdate: ISkipUpdate<T> = null): T {\n  if (deps === null || deps === undefined || !Array.isArray(deps)) {\n    if (typeof deps === \"function\") {\n      skipUpdate = deps;\n    }\n    return useTrackerNoDeps(reactiveFn, skipUpdate);\n  } else {\n    return useTrackerWithDeps(reactiveFn, deps, skipUpdate);\n  }\n}\n\nconst useTrackerServer: typeof useTrackerClient = (reactiveFn) => {\n  return Tracker.nonreactive(reactiveFn);\n}\n\n// When rendering on the server, we don't want to use the Tracker.\n// We only do the first rendering on the server so we can get the data right away\nconst useTracker = Meteor.isServer\n  ? useTrackerServer\n  : useTrackerClient;\n\nfunction useTrackerDev (reactiveFn, deps = null, skipUpdate = null) {\n  function warn (expects: string, pos: string, arg: string, type: string) {\n    console.warn(\n      `Warning: useTracker expected a ${expects} in it\\'s ${pos} argument `\n        + `(${arg}), but got type of \\`${type}\\`.`\n    );\n  }\n\n  if (typeof reactiveFn !== 'function') {\n    warn(\"function\", \"1st\", \"reactiveFn\", reactiveFn);\n  }\n\n  if (deps && skipUpdate && !Array.isArray(deps) && typeof skipUpdate === \"function\") {\n    warn(\"array & function\", \"2nd and 3rd\", \"deps, skipUpdate\",\n      `${typeof deps} & ${typeof skipUpdate}`);\n  } else {\n    if (deps && !Array.isArray(deps) && typeof deps !== \"function\") {\n      warn(\"array or function\", \"2nd\", \"deps or skipUpdate\", typeof deps);\n    }\n    if (skipUpdate && typeof skipUpdate !== \"function\") {\n      warn(\"function\", \"3rd\", \"skipUpdate\", typeof skipUpdate);\n    }\n  }\n\n  const data = useTracker(reactiveFn, deps, skipUpdate);\n  checkCursor(data);\n  return data;\n}\n\nexport default Meteor.isDevelopment\n  ? useTrackerDev as typeof useTrackerClient\n  : useTracker;\n"]},"sourceType":"module","externalDependencies":{},"hash":"5758c4a6616dac537d17a2c167163bc4d1eecaad"}
